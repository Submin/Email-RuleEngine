# Email-RuleEngine
Модуль обработки почтовых сообщений по заданным правилам


### Описание

Терм.:
    * нода - набор правил обработки email и вспомогательных полей
    * правило - структура состоящая из выражения, действия и маршрутизирующей информации. При истинности выражения правила срабатывает действие и осуществляется маршрутизация email
    * выражение - вычисляемый объект, содержащий поля или подвыражения, вычисляющий их опратор и его тип. Результатом вычисления выражения является булево значение.
    * действие - структура, содержащая все необходимые данные для выполнения какой либо операции на email.
    * идентификатор потомка - указатель на следующую ноду (маршрутизирующая информация).


####node of nodes
```
[
  {
    id => node_id (int),
    name => node_name (char),
    parent => [
        parent_node_id (int),
    ],
    rules => [
        {
            expression => {
                expression => [],
                type => 'expression_type', # [BOOL|CMP|CONSIST|REGEXP|SUBNET]
                op => 'op' # BOOOL OPS: '&& || ! ^', CMP OPS: 'eq ne lt gt le le == != < > <= =>', CONSIST OPS: 'in notin', REGEXP OPS: '!~ =~', SUBNET OPS: 'in notin'
            },
            action => {
                type => 'action_type', # [MARK|KILL|GOTO|RESOLVE|EXTRACT]
                name => 'action_name',
                fields => {
                    key => value
                },
                options => {
                }
            },
            child_id => child_node_id
        },
    ],
  }
]
```

Решение по фильтрации и маршрутизации почтовых сообщений  располжено на *плоскости решений* состоящей из сети нодов.
Нода может иметь несколько входов и несколько выходов (но не менее одного).
Каждая нода имеет уникальный идентификатор, а так же набор полей, позволяющих однозначно определять

### Expressionset
```
{
  expression: [
    {
      expression: [
        'a',
        'b'
      ],
      type: 'INT',
      op: 'eq'
    },
    {
      expression: [
        'c',
        'd',
        {
          expression: [
            'e'
          ],
          type: 'BOOL',
          op: 'NOT'
        }
      ],
      type: 'BOOL',
      op: 'OR'
    }
  ],
  type: 'BOOL',
  op: 'AND'
}
```
